language: ruby
rvm:
  - 2.6
  - 2.5
  - 2.4

env:
  - GEM_FILE=gemfiles/rails_4.2.gemfile
  - GEM_FILE=gemfiles/rails_5.0.gemfile
  - GEM_FILE=gemfiles/rails_5.1.gemfile
  - GEM_FILE=gemfiles/rails_5.2.gemfile

stages:
  # We want to test each and every branch.
  - name: test
    if: NOT tag =~ .*
  # We just want docs generation on the master branch.
  - name: docs
    if: branch = master AND type IN (push, api)
  # After a new tag was released, we build the docs.
  - name: release-docs
    if: tag =~ .* AND type IN (push, api)

jobs:
  include:
    # Test Build
    - &test
      stage: test
      install: echo "test install"
      script: time make test
      after_script: echo "codeclimate"

    # Documentation Build
    - <<: *test
      stage: docs
      install: echo "docs install"
      script: echo "docs script"
      after_script: "docs after_script"

    # Documentation Build
    - <<: *test
      stage: release-docs
      install: echo "release-docs install"
      script: echo "release-docs script"
      after_script: true
      
install: echo "root install"
script: echo "root script"
