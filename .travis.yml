# We don't need sudo as such, but setting sudo: required allows us to run on
# the faster machines which means that the builds complete much faster (in
# about half the time). For comparison, here are two builds on the two
# different machines:
# - With `sudo: false`: https://travis-ci.org/opbeat/opbeat-node/builds/252301998
# - With `sudo: required`: https://travis-ci.org/opbeat/opbeat-node/builds/252302576
sudo: required
dist: trusty

language: node_js

services:
  - mysql
  - mongodb
  - redis-server
  - postgresql
  - cassandra
  
cache:
  directories:
    - deb-cache
  
env:
  global:
    - ELASTICSEARCH_DEB_VERSION=6.0.6
    - ELASTICSEARCH_DEB_PACKAGE=elasticsearch-${ELASTICSEARCH_DEB_VERSION}.deb

before_install:
  - echo $ELASTICSEARCH_DEB_VERSION
  - echo $ELASTICSEARCH_DEB_PACKAGE
  - echo "curl -o ./deb-cache/$ELASTICSEARCH_DEB_PACKAGE https://artifacts.elastic.co/downloads/elasticsearch/$ELASTICSEARCH_DEB_PACKAGE"
  - |
    if [ ! -f ./deb-cache/$ELASTICSEARCH_DEB_PACKAGE ]
    then
      curl -o ./deb-cache/$ELASTICSEARCH_DEB_PACKAGE https://artifacts.elastic.co/downloads/elasticsearch/$ELASTICSEARCH_DEB_PACKAGE
    fi
  - sudo dpkg -i --force-confnew ./deb-cache/elasticsearch-6.6.0.deb && sudo service elasticsearch restart

node_js:
  - '12'

install: true
script: true

notifications:
Â  email: false
